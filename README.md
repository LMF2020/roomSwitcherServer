## Pair Switcher

#### 安装 & 启动

`yarn install` & `npm run dev`

#### 🥳 1.0 协议设计

https://www.showdoc.com.cn/roomswitcher/11176109908791492

#### 1.1 获取设备序列号

一. 加密设计
加密格式：Base64(AES[序列号,,30,,start_timestamp])
加密 key（AES）: xxxxx

二. 技术实现：vue3 + electron + socketIO // 辅助工具 tailwind + vuex/vue-router

1. 需要两个界面
   - 1.1. 授权页面：授权成功后，才会开启端口监听
   - 1.2. 服务器状态页面： 客户端连接后会更新客户端已连接和显示客户端的 IP
2. 创建 socket 服务实例：主进程启动时，创建 socket 实例
   - 2.1 主进程发送 IPC message 给渲染进程，展示给授权页面
3. 授权：主进程启动时，加载授权页面
   - 3.1 主进程获取设备序列号 - IPC 通知 - 渲染进程（显示设备序列号）
   - 3.2 用户点击授权，渲染进程 - IPC 通知 - 主进程验证授权（C++ node wrapper 实现）
   - 3.3 主进程验证授权成功 -
   - 3.3.1 主进程开启 3001 端口开始监听客户端连接
   - 3.3.2 IPC 通知（携带授权信息） - 渲染进程
   - 3.3.3 渲染进程 - 切换路由 - 服务器状态页（- 展示授权信息，服务器监听的端口信息，客户端连接信息（-- 后续客户端连接才展示 --- ））
4. 客户端连接处理：

   - 4.1 收到客户端连接后，记录 socket id，客户端 IP -- IPC 通知 -- 渲染进程 （如上 3.3.1 的状态页面展示客户端连接信息）
   - 4.2 客户端发送请求报文 -- 主进程直接处理指令 （协议如下）
   - 4.3 协议规范:
   - ipad 控制器 -> PC: 切换命令 -> 执行切换动作
     发送命令：cmd_fs: 切换到 飞书
     发送命令：cmd_tx: 切换到 腾讯

   - ipad 控制器 -> PC: 查询当前进程
     发送命令：qry_current_rooms
     返回报文: {"rooms":"name"} --- [name]: fs,tx，none

   - 4.3 进程切换: open "scheme://"

---

#### 页面设计

授权到期: 2024-06-30
服务器已连接: 127.0.0.1:3001

    -> 客户端 192.168.01.1 已连接/已断开
    -> 客户端 192.168.01.2 已连接/已断开

## 后续功能和 待 fix 的问题

## PC 端 - 切换器：

1. 实现端口修改，不停止当前服务，重新挂载进程
2. 实现重新授权功能，授权码过期提示，重新授权激活
3. 实现 Windows 桌面端
4. 支持 sass 授权版本
5. 提供管理平台（提供管理页面对运行的机器进行统一管理，减少人工成本 -- 纯内网版本，需要提供一台服务器，配置不需要太高）
   - 机器注册
   - 机器服务状态查看
   - 一键重启/停止服务
   - 机器服务续期
   - 机器异常监控告警
   - 统一更新版本
   - 查看机器版本
6. 实现 Pad 端自动扫描可用机器，选择连接指定的机器
7. 实现二维码连接
8. 支持更多会议室系统切换
9. 支持更多指令的配置
10. 支持 Android 版本的 Pad 程序
11. 程序安全加密
12. 安全组件升级
13. 支持 sass 版本在线授权
14. 支持一件结束机器上所有的 RoomAPP
15. 增加更多指令控制功能
16. 持续维护更新 bug fix 的版本解决一些切换的小问题，比如乱序等


#### 前置条件'
- windows 段需要开放指定端口
- 管理员运行 netsh advfirewall firewall add rule name="Open Port 52013" dir=in action=allow protocol=TCP localport=52013